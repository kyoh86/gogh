# Copilot Instructions for gogh Project

## Output Language
- Explanations should be primarily in Japanese
- Code comments, error messages, test case titles, etc. should be written in English

## Project Location
- gogh is managed at `github.com/kyoh86/gogh`
- Package names may have version suffixes (e.g., `github.com/kyoh86/gogh/v4`)

## How to Write Tests
- Tests for private functions/methods: Place in a file named `_private_test.go` in the same package
- Tests for public functions/methods: Place in a file named `*_test.go` with `_test` appended to the package name in the same directory
- When importing the package being tested, use the name `testtarget`
- Use the standard `testing` package, not `testify/assert` or `testify/require`

## How to Place Mocks
- Mocks are typically generated by `mockgen` in a separate package at the same level as the package defining the interface
- Example: Mocks for the `core/repository` package are placed in `core/repository_mock`
- The naming convention for mock files is `gen_<lowercase_interface_name>_mock.go`
- Example: The mock for the `DefaultNameService` interface is `gen_default_name_service_mock.go`
- Place `go:generate` commands in a `gen.go` file to generate mocks
- Use the `go.uber.org/mock/gomock` package for mock generation

## Directory Structure
```
gogh/
├── app/              # Application layer (use cases)
│   ├── auth/         # Authentication-related use cases
│   ├── bundle/       # Bundle (repository batch management) use cases
│   ├── clone/        # Clone operation use cases
│   ├── fork/         # Fork operation use cases
│   ├── repos/        # Repository list display use cases
│   └── service/      # Common services (used across multiple use cases)
│
├── core/             # Core layer (domain models and interfaces)
│   ├── auth/         # Authentication-related interfaces
│   ├── git/          # Git operation interfaces
│   ├── hosting/      # Repository hosting service interfaces
│   ├── repository/   # Repository representation and path operation interfaces
│   ├── store/        # Data persistence interfaces
│   └── workspace/    # Workspace management interfaces
│   ├── *_mock/       # Packages containing mocks for each interface
│
├── infra/            # External system integration layer (implementations of core interfaces)
│   ├── auth/         # Authentication implementation
│   ├── git/          # Git operation implementation
│   ├── github/       # GitHub API integration
│   ├── store/        # Data persistence implementation
│   └── workspace/    # Workspace management implementation
│
└── ui/               # UI layer (user interfaces)
    └── cli/          # Command-line interface
        └── commands/ # Implementation of various commands
```

## Architecture of the Project

### 1. Four Main Concerns (Layers)

#### Core Functionality Layer (core/)
- Definition: Domain entities and interfaces required for interaction with external systems
- Dependencies: None (innermost layer)
- Implementation: Domain entities and pure logic
- Examples: Repository references, hosting service interfaces, authentication interfaces

#### Application Layer (app/)
- Definition: Realizes use cases and coordinates core functionalities
- Dependencies: Only imports interfaces from the core layer
- Implementation: Combines core functionalities to perform actual processing, use case flows
- Examples: Use cases for cloning, forking, listing repositories, etc.

#### External System Integration Layer (infra/)
- Definition: Integration with external systems and technical implementations
- Dependencies: Imports interfaces and types from the core layer
- Implementation: API clients, database connections, file operations
- Examples: GitHub API client, file-based store implementation

#### UI Layer (ui/)
- Definition: Methods for user interaction
- Dependencies: Can import from the application layer
- Implementation: Command-line interface, output formatting
- Examples: Cobra-based CLI commands, text output formatters

### 2. Dependency Rules
1. Core layer: Does not import from any other layer
2. Application layer: Can only import from the core layer
3. External system integration layer: Can only import from the core layer
4. UI layer: Can import from the application layer

### 3. Interface-Based Integration
- Core layer defines interfaces
- External system integration layer implements interfaces
- Application layer uses interfaces to call external systems

## Core Rules of gogh
- Repository reference definition: Interpretation rules for the `github.com/owner/repo` format
- Repository components: Basic attributes such as name, owner, URL format, etc.
- Structuring and organization rules: Path structure `<root>/<host>/<owner>/<name>`
- Basic operation concepts: Abstract concepts like cloning, searching, etc.

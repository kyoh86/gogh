# プログラム構造の全体像

## 1. 4つの主要な関心事（レイヤー）

### コア機能層 (core)

- **役割**: プログラムが実行する本質的な操作と概念の定義
- **このプロジェクトでの例**: リポジトリ参照の処理、リポジトリ操作の定義
- **内容**: データ構造、インターフェース、基本的な操作
- **特徴**: 外部システムやUIに依存しない純粋な機能

### アプリケーション層 (app)

- **役割**: ユースケースの実現とコア機能の調整
- **このプロジェクトでの例**: リポジトリのクローン処理、リスト取得ロジック
- **内容**: サービスオブジェクト、ユースケースハンドラ
- **特徴**: コア機能を組み合わせて実際の処理を行う

### 外部システム連携層 (infra)

- **役割**: プログラムの外部との連携や技術的実装
- **このプロジェクトでの例**: GitHub API呼び出し、トークン保存、ファイル操作
- **内容**: APIクライアント、データベース接続、ファイル操作
- **特徴**: コア層で定義されたインターフェースの実装

### ユーザーインターフェース層 (ui)

- **役割**: ユーザーとのインタラクション方法
- **このプロジェクトでの例**: CLIコマンド、出力フォーマット
- **内容**: コマンド実装、表示ロジック、入力処理
- **特徴**: ユーザーの要求をアプリケーション層に伝える

## 2. 実践的な依存関係ルール

1. **コア機能層の依存ルール**
   - コア機能層は他のどの層も**インポートしない**
   - (他の層がコア層をインポートすることは可能)
   - 理由: コアはアプリケーション特有の処理や外部連携に依存すべきでない

2. **アプリケーション層の依存ルール**
   - アプリケーション層はコア機能層を**インポートできる**
   - UIや外部システム層をインポート**しない**
   - 理由: ユースケースはコア機能を使うが、具体的な実装方法やUIには依存しない

3. **外部システム連携層の依存ルール**
   - 外部システム連携層はコア機能層を**インポートできる**
   - UIやアプリケーション層をインポート**しない**
   - 理由: 外部連携はコアのインターフェースを実装するが、UIやユースケースの詳細を知る必要はない

4. **UI層の依存ルール**
   - アプリケーション層を**インポートできる**
   - 理由: UIはユースケースを呼び出して実行する

## 3. インターフェースによる連携

1. **インターフェースの所有者**
   - 使う側のレイヤーがインターフェースを定義する
   - 例: リモートリポジトリのインターフェースはコア層で定義

2. **コア層でのインターフェース定義例**
   ```go
   // core/repository/service.go
   type RepositoryService interface {
       Get(name string) (Repository, error)
       List() ([]Repository, error)
   }
   ```

3. **アプリケーション層でのユースケース例**
   ```go
   // app/clone/service.go
   type CloneService struct {
       repoService core.RepositoryService
   }
   
   func (s *CloneService) CloneRepository(name string) error {
       repo, err := s.repoService.Get(name)
       if err != nil {
           return err
       }
       // クローン処理を実装
   }
   ```

4. **外部連携層での実装例**
   ```go
   // infra/github/client.go
   type githubClient struct {...}

   // コア層のインターフェースを実装
   func (c *githubClient) Get(name string) (core.Repository, error) {
       // GitHub APIを使った実装
   }
   ```

## 4. 推奨ディレクトリ構造

```
gogh/
├── core/              # コア機能 - プログラムの本質
│   ├── repository/    # リポジトリ関連の定義
│   └── auth/          # 認証関連の定義
│
├── app/               # アプリケーション - ユースケース
│   ├── clone/         # クローン機能のユースケース
│   └── list/          # リスト機能のユースケース
│
├── infra/             # 外部システム連携 - 外の世界との接続
│   ├── github/        # GitHub API実装
│   └── storage/       # データ保存実装
│
└── ui/                # ユーザーインターフェース - 使い方
    └── cli/           # コマンドライン実装
```

## 5. 実際のケーススタディ

クローン操作を例にすると:

1. **UI層**: `clone` コマンドがユーザーからのリポジトリ指定を受け取る
2. **アプリケーション層**: `CloneService` がクローン操作全体を調整
3. **外部システム層**: GitHub APIクライアントがリポジトリ情報を取得
4. **コア層**: リポジトリインターフェースがクローンに必要な情報を定義

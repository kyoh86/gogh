# プログラム構造の全体像

## 1. 3つの主要な関心事（レイヤー）

### コア機能層 (core)

- **役割**: プログラムが実行する本質的な操作と概念
- **このプロジェクトでの例**: リポジトリ参照の処理、リポジトリ操作の定義
- **内容**: データ構造、インターフェース、基本的な操作
- **特徴**: 外部システムやUIに依存しない純粋な機能

### 外部システム連携層 (infra)

- **役割**: プログラムの外部との連携や技術的実装
- **このプロジェクトでの例**: GitHub API呼び出し、トークン保存、ファイル操作
- **内容**: APIクライアント、データベース接続、ファイル操作
- **特徴**: コア層で定義されたインターフェースの実装

### ユーザーインターフェース層 (ui)

- **役割**: ユーザーとのインタラクション方法
- **このプロジェクトでの例**: CLIコマンド、出力フォーマット
- **内容**: コマンド実装、表示ロジック、入力処理
- **特徴**: ユーザーの要求をコア機能や外部連携に伝える

## 2. 実践的な依存関係ルール

1. **コア機能層の依存ルール**
   - UIや外部システム連携からインポート**しない**
   - 理由: コア操作はトリガーやデータの取得方法に依存すべきでない

2. **外部システム連携層の依存ルール**
   - コア機能層を**インポートできる**
   - UIをインポート**しない**
   - 理由: GitHub連携はコアの概念を知る必要があるが、コマンドラインの詳細は知る必要ない

3. **UI層の依存ルール**
   - コア機能層と外部システム連携層の両方を**インポートできる**
   - 理由: コマンドは機能とデータの両方を必要とする

## 3. インターフェースによる連携

1. **インターフェースの所有者**
   - 使う側がインターフェースを定義する
   - 例: リモートリポジトリのインターフェースはコア層で定義

2. **コア層でのインターフェース定義例**
   ```go
   // core/repository/service.go
   type RepositoryService interface {
       // リポジトリの基本操作
       Get(name string) (Repository, error)
       List() ([]Repository, error)
   }
   ```

3. **外部連携層での実装例**
   ```go
   // infra/github/client.go
   type githubClient struct {...}
   
   // コア層のインターフェースを実装
   func (c *githubClient) Get(name string) (core.Repository, error) {
       // GitHub APIを使った実装
   }
   ```

## 4. 推奨ディレクトリ構造

```
gogh/
├── core/              # コア機能 - プログラムの本質
│   ├── repository/    # リポジトリ関連の定義
│   └── auth/          # 認証関連の定義
│
├── infra/             # 外部システム連携 - 外の世界との接続
│   ├── github/        # GitHub API実装
│   └── storage/       # データ保存実装
│
└── ui/                # ユーザーインターフェース - 使い方
    └── cli/           # コマンドライン実装
```
